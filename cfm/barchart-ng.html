<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Angular chart directives experiments</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../src/css/dc-1.7.5.css"/>
    <link rel="stylesheet" href="../tmp/compiled/angular-singular.css"/>
  </head>
  <body>
    <h2 id='begin'>Angular chart directives experiments</h2>

    <div ng-app='Barchart'>
      <div ng-controller='cntlr' class='container'>
        {{ff.name}}
        <div singular-barchart
             config="ff"
             filters="filters[ff.field]"
             range-filters="rangeFilters[ff.field]"
             on-filter-changes="onFilterChange()"></div>
      </div>
    </div>

    <script src="../bower_components/angular/angular.min.js"></script>
    <script src="../bower_components/d3/d3.min.js"></script>
    <script src='../src/js/crossfilter_1.3.7_quicksort_modified.js'></script>
    <script src='../src/js/dc_1.7.5_modified.js'></script>
    <script src='../tmp/compiled/interface.js'></script>
    <script src='../src/js/angular-singular.js'></script>

    <script type="text/javascript">
      angular.module('Barchart', ["Singular"])
      .controller('cntlr', [ '$scope',
        function ($scope) {
          if (!$scope.filters) {
            d3.json("../src/assets/angular-barchart-data.json", function(err, json) {
              if (err) return console.warn(err);
              $scope.filters = json;
            });
          };

          var fieldWidth = window.innerWidth * 0.5 > 500 ? 500 : window.innerWidth * 0.5,
              fieldHeight = 100;
          $scope.config = {
            rangeFacetFields: {
              mw: {
                field: 'mw',
                name: 'Molecular Weight',
                unit: 'Molecular Weight, Daltons ',
                xmin: 1,
                xmax: 200,
                xtickscale: 10,
                width: fieldWidth,
                height: fieldHeight,
              },
            },
          };
          // A shortcut ("facet field") for use in the HTML:
          $scope.ff = $scope.config.rangeFacetFields.mw;

          $scope.onFilterChange = function () {
            console.info(JSON.stringify($scope.rangeFilters));
          };
        }
      ]);
    </script>
  </body>
</html>
